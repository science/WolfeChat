import{r as m,c as b,b as T}from"./index-5e7d5207.js";function i(t){return new Promise(n=>setTimeout(n,t))}async function y(t,n=3e3,e=50){const s=performance.now();for(;!t();){if(performance.now()-s>n)throw new Error("waitFor: timeout");await i(e)}}function x(){const t=document.querySelector(".main-content-area");return t?t.querySelector(".overflow-y-auto"):null}function g(t,n=60){return Array.from({length:n},(e,s)=>`${t} line ${s+1} — lorem ipsum dolor sit amet.`).join(`
`)}async function k(t=3){const n=[];for(let e=0;e<t;e++)n.push({role:"user",content:g(`User turn ${e+1}`)}),n.push({role:"assistant",content:g(`Assistant turn ${e+1}`)});b.set([{title:"Test Long Conversation",assistantRole:"assistant",conversationTokens:0,history:n}]),T.set(0),await y(()=>document.querySelectorAll(".message").length>=n.length)}function v(t){const n=Array.from(t.querySelectorAll(".message")),e=t.getBoundingClientRect();return n.map(r=>r.getBoundingClientRect().top-e.top+t.scrollTop)}function A(){return document.querySelector('button[aria-controls="quick-settings-body"]')}function C(){const t=document.getElementById("quick-settings-body");if(!t)return{upBtn:null,downBtn:null};const n=Array.from(t.querySelectorAll("button")),e=(o,c)=>(o.textContent||"").trim().toLowerCase()===c.toLowerCase(),s=n.find(o=>e(o,"Up"))||n.find(o=>e(o,"▲ Up"))||n.find(o=>e(o,"up"))||null,r=n.find(o=>e(o,"Down"))||n.find(o=>e(o,"▼ Down"))||n.find(o=>e(o,"down"))||null;return{upBtn:s,downBtn:r}}function a(t,n,e=10){return Math.abs(t-n)<=e}m({id:"conv-nav-prev-next",name:"Quick Settings Up/Down navigates between conversation turns",tags:["ui","non-api","navigation"],timeoutMs:15e3,fn:async t=>{const n=A();if(t.that(!!n,"Quick Settings toggle button should exist"),!n)return;n.getAttribute("aria-expanded")!=="true"&&(n.click(),await i(100));const{upBtn:e,downBtn:s}=C();if(t.that(!!e,"Up button should exist in Quick Settings"),t.that(!!s,"Down button should exist in Quick Settings"),!e||!s)return;await k(4);const r=x();if(t.that(!!r,"Chat scroll container should exist"),!r)return;const o=v(r);if(t.that(o.length>=8,"Expected at least 8 message anchors"),o.length<8)return;const c=3,f=o[c]+100;r.scrollTop=f,await i(100),e.click(),await i(150);const p=r.scrollTop;t.that(a(p,o[c]),`After Up, scrollTop should be near anchor ${c}`),s.click(),await i(150);const d=r.scrollTop;t.that(a(d,o[c+1]),`After Down, scrollTop should be near anchor ${c+1}`);let l=c+2;for(;l<o.length;){s.click(),await i(120);const h=r.scrollTop;l<o.length&&t.that(a(h,o[Math.min(l,o.length-1)])||a(h,r.scrollHeight-r.clientHeight,15),`After Down, scrollTop should be near anchor ${Math.min(l,o.length-1)} or bottom`),l++}let u=Math.max(0,o.length-2);for(;u>=0;){e.click(),await i(120);const h=r.scrollTop;t.that(a(h,o[u])||u===0&&a(h,0,5),`After Up, scrollTop should be near anchor ${u} (or top for first anchor)`),u--}const w=r.scrollTop;e.click(),await i(100),t.that(a(r.scrollTop,w,2),"Extra Up at the start should not change scroll position")}});
